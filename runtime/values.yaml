# Modifications Copyright (C) 2025 Advanced Micro Devices, Inc. All rights reserved.
# Portions of this file consist of AI-generated content.
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.

# AUP Learning Cloud - Deployment Configuration
#
# Deploy with:
#   helm install jupyterhub ./chart -n jupyterhub --create-namespace -f values.yaml
#
# This file contains environment-specific overrides.
# See jupyterhub/values.yaml for all available options and defaults.

# Custom overrides (uncomment to customize)
# custom:
#   authMode: "github"  # auto-login | dummy | github | multi
#   adminUser:
#     enabled: true
#   accelerators:
#     my-gpu:
#       displayName: "My Custom GPU"
#       nodeSelector:
#         node-type: my-gpu
#       quotaRate: 2
#   resources:
#     images:
#       my-course: "my-registry/my-image:latest"
#     requirements:
#       my-course:
#         cpu: "4"
#         memory: "16Gi"
#   teams:
#     mapping:
#       my-team:
#         - my-course

# Use K3s built-in local-path storage (no NFS required)
hub:
  db:
    pvc:
      storageClassName: local-path
  image:
    name: ghcr.io/amdresearch/auplc-hub
    tag: latest
    pullPolicy: IfNotPresent

  # Additional Python config snippets (executed after core/setup.py)
  # Example:
  #   myconfig: |
  #     c.JupyterHub.some_setting = "value"
  extraConfig: {}

  extraFiles:
    announcement.txt:
    # If you want to edit the notice on login.html, change here.
      mountPath: /usr/local/share/jupyterhub/static/announcement.txt
      stringData: |
          <div class="announcement-box" style="padding: 1em; border: 1px solid #ccc; border-radius: 6px; background-color: #f8f8f8;">
          <h3>Welcome to AUP Learning Cloud!</h3>
          <p>This is a <strong>dynamic announcement</strong>.</p>
          <p>My location is on <code>runtime/values.yaml</code></p>
          <p>You can edit this via <strong>ConfigMap</strong> without rebuilding the image.</p>
          </div>

  config:
    # ---- Hub Core ----
    # JupyterHub:
      # Enable JupyterHub REST API
      # API Documentation: https://jupyterhub.readthedocs.io/en/stable/reference/rest-api.html
      # api_tokens:
      #   Configure API tokens for external services
      #   Format: token: username
      #   It's recommended to use environment variables or secrets to manage tokens
      #   Example: "your-secure-api-token-here": "admin-service"

    Authenticator:
      allow_all: true

    # ---- GitHub OAuth ----
    GitHubOAuthenticator:
      oauth_callback_url: "https://<Your.domain>/hub/github/oauth_callback"
      client_id: "TODO"
      client_secret: "TODO"
      allowed_organizations:
        - <YOUR-ORG-NAME>
      scope:
        - read:user
        - read:org

    # ---- KubeSpawner Prepuller Setup ----
    KubeSpawner:
      image_pull_policy: IfNotPresent

singleuser:
  storage:
    dynamic:
      storageClass: local-path

# Use NodePort for direct access
proxy:
  service:
    type: NodePort
    nodePorts:
      http: 30890

# Disable ingress (use NodePort instead)
ingress:
  enabled: false

# Disable prePuller for faster deployment
# Images will be pulled on-demand when users spawn notebooks
prePuller:
  hook:
    enabled: false
  continuous:
    enabled: false
