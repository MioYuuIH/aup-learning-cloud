<!-- Modifications Copyright (C) 2025 Advanced Micro Devices, Inc. All rights reserved.
 Portions of this file consist of AI-generated content. -->
<!--
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->



{% extends "page.html" %}

{% if announcement_login is string %}
{% set announcement = announcement_login %}
{% endif %}

{% block login_widget %}
{% endblock login_widget %}

{%- block title -%}
AUP Learning Cloud
{%- endblock title -%}

{% block scripts %}
<script src="https://cdn.tailwindcss.com" type="text/javascript" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" type="text/javascript" charset="utf-8"></script>
{% endblock scripts %}

{% block require_config %}
<!-- Login page doesn't need RequireJS config -->
{% endblock require_config %}

{% block nav_bar %}
{% endblock nav_bar %}

{% block main %}
{% block login %}
<div class="min-h-screen flex flex-col md:flex-row">
    <div class="w-full md:w-2/5 bg-black flex flex-col justify-center items-center p-10 md:p-16">
        <div class="text-center">
            <svg class="w-24 mb-6 mx-auto" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 139.72 33.32">
                <defs>
                    <style>
                        .cls-1 {
                            fill: #fff;
                        }
                    </style>
                </defs>
                <title>AMD-logo-white-v2</title>
                <path class="cls-1"
                    d="M33,31.14H25.21l-2.37-5.72H9.92L7.76,31.14H.14L11.78,2.26h8.34Zm-16.89-22L11.83,20.39h8.89Z"
                    transform="translate(-0.14 -0.03)" />
                <path class="cls-1"
                    d="M61.1,2.26h6.27V31.14h-7.2v-18l-7.79,9.06h-1.1L43.49,13.1v18h-7.2V2.26h6.27L51.83,13Z"
                    transform="translate(-0.14 -0.03)" />
                <path class="cls-1"
                    d="M85.61,2.26c10.54,0,16,6.56,16,14.48,0,8.3-5.25,14.4-16.77,14.4H72.86V2.26ZM80.06,25.85h4.7c7.24,0,9.4-4.91,9.4-9.15,0-5-2.67-9.15-9.48-9.15H80.06Z"
                    transform="translate(-0.14 -0.03)" />
                <polygon class="cls-1"
                    points="130.64 9.08 115.75 9.08 106.68 0 139.72 0 139.72 33.05 130.64 23.97 130.64 9.08" />
                <polygon class="cls-1"
                    points="115.74 23.98 115.74 10.9 106.4 20.24 106.4 33.33 119.48 33.33 128.82 23.98 115.74 23.98" />
            </svg>
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">AUP Learning Cloud</h2>
            <p class="text-blue-100 mb-8">Experience the next generation of AI acceleration with AMD ROCm™.</p>
            {% if login_service %}
            <a role="button"
                class='inline-block bg-white hover:bg-gray-100 text-black font-medium py-2 px-4 rounded transition duration-300'
                href='{{ authenticator_login_url | safe }}'>
                Sign in with {{ login_service }}
            </a>
            {% endif %}
        </div>
    </div>
    <div class="w-full md:w-3/5 flex items-center justify-center p-6 md:p-16">
        <div class="w-full max-w-md">
            {% block login_container %}
            <div id="announcement-box" class="bg-yellow-100 text-yellow-800 border border-yellow-300 p-4 mb-6 rounded hidden">
                Now loading external announcement...
            </div>
            
            <script>
                fetch("/hub/static/announcement.txt")
                    .then(resp => {
                        if (!resp.ok) throw new Error("Not found");
                        return resp.text();
                    })
                    .then(data => {
                        const box = document.getElementById("announcement-box");
                        box.innerHTML = data;
                        box.classList.remove("hidden");
                    })
                    .catch(err => {
                        console.warn("External announcement.txt load fail", err);
                    });
            </script>
            <div class="bg-white rounded-xl shadow-lg p-8">
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold text-gray-800">Login to AUP Learning Cloud</h1>
                    {% if authenticator_mode == 'dummy' %}
                    <p class="text-sm text-orange-600 mt-2">⚠️ Development Mode - Any username/password accepted</p>
                    {% endif %}
                </div>

                {% if login_error %}
                <p class="text-red-500 font-medium mb-4 text-center">{{ login_error }}</p>
                {% endif %}

                {% if authenticator_mode == 'dummy' %}
                <!-- Dummy Authenticator: Simple login form -->
                <form action="{{ base_url }}login?next={{ next | urlencode }}" method="post" role="form" class="space-y-6">
                    <input type="hidden" name="_xsrf" value="{{ xsrf }}" />

                    <div>
                        <label for="username_input" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input id="username_input" type="text" autocapitalize="off" autocorrect="off" autocomplete="username"
                            name="username" value="{{ username }}" autofocus="autofocus"
                            class="block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>

                    <div>
                        <label for="password_input" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input id="password_input" type="password" autocomplete="current-password" name="password"
                            class="block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>

                    <div class="mt-6">
                        <button id="login_submit" type="submit"
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                            Login
                        </button>
                    </div>
                </form>

                {% elif authenticator_mode == 'github' %}
                <!-- GitHub OAuth Only -->
                <!-- NOTE: Do NOT add "| urlencode" to OAuth links! JupyterHub already URL-escapes
                     the "next" variable. OAuth stores next in a cookie as-is, so double-encoding
                     causes redirects to fail (e.g., /hub/%2Fhub%2F instead of /hub/).
                     Form POST actions DO need urlencode due to different browser/server handling. -->
                <div class="mb-6">
                    <a href="{{ base_url }}oauth_login?next={{ next }}"
                       class="w-full flex justify-center items-center py-3 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"/>
                        </svg>
                        Sign in with GitHub
                    </a>
                </div>

                {% else %}
                <!-- Multi Authenticator: GitHub OAuth + Native accounts -->
                <!-- GitHub OAuth Button -->
                <!-- NOTE: Do NOT add "| urlencode" here - see comment above for explanation -->
                <div class="mb-6">
                    <a href="{{ base_url }}github/oauth_login?next={{ next }}"
                       class="w-full flex justify-center items-center py-3 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"/>
                        </svg>
                        Sign in with GitHub
                    </a>
                </div>

                <div class="relative mb-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">Or use local account</span>
                    </div>
                </div>

                <!-- Local Account Login Form -->
                <form action="{{ base_url }}native/login?next={{ next | urlencode }}" method="post" role="form" class="space-y-6">
                    <input type="hidden" name="_xsrf" value="{{ xsrf }}" />

                    <div>
                        <label for="username_input" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input id="username_input" type="text" autocapitalize="off" autocorrect="off" autocomplete="username"
                            name="username" value="{{ username }}" autofocus="autofocus"
                            class="block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>

                    <div>
                        <label for="password_input" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input id="password_input" type="password" autocomplete="current-password" name="password"
                            class="block w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>

                    <div class="mt-6">
                        <button id="login_submit" type="submit"
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                            Login
                        </button>
                    </div>
                </form>
                {% endif %}

            </div>
            {% endblock login_container %}
        </div>
    </div>

</div>
{% endblock login %}
{% endblock main %}

{% block script %}
{{ super() }}
<script>
    if (!window.isSecureContext) {
        // unhide http warning
        var warning = document.getElementById('insecure-login-warning');
        if (warning) {
            warning.className = warning.className.replace(/\bhidden\b/, '');
        }
    }
    // setup onSubmit feedback
    $('form').submit((e) => {
        var form = $(e.target);
        form.find('.feedback-container button').attr('disabled', true);
        form.find('.feedback-container>*').toggleClass('hidden');
    });
</script>
{% endblock script %}
