<!-- Modifications Copyright (C) 2025 Advanced Micro Devices, Inc. All rights reserved.
 Portions of this file consist of AI-generated content. -->
<!--
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->



<!-- Dockerfile/Hub/templates/resource_options_form.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Selection</title>

<style>
    @media (prefers-color-scheme: dark) {
        .resource-container {
            background: var(--jp-layout-color1) !important;
            border-color: var(--jp-border-color1) !important;
        }
        .resource-container h5,
        .resource-container strong {
            color: var(--jp-ui-font-color0) !important;
        }
        .resource-container .env-desc {
            color: var(--jp-ui-font-color1) !important;
        }
        .resource-container .dot {
            color: var(--jp-ui-font-color2) !important;
        }
        .resource-container .resource-tag {
            color: var(--jp-warn-color0) !important;
            background: var(--jp-warn-color3) !important;
            border-color: var(--jp-warn-color2) !important;
        }
        .resource-container input[type="number"] {
            background: var(--jp-layout-color1) !important;
            color: var(--jp-ui-font-color1) !important;
            border-color: var(--jp-border-color1) !important;
        }
        .gpu-selection {
            background: var(--jp-layout-color1) !important;
            border-color: var(--jp-border-color1) !important;
        }
        .gpu-option {
            background: var(--jp-layout-color0) !important;
            border-color: var(--jp-border-color1) !important;
        }
        .resource-category-header {
            color: var(--jp-ui-font-color0) !important;
            background: var(--jp-layout-color2) !important;
            border-color: var(--jp-border-color1) !important;
        }
        .collapsible-content {
            background: var(--jp-layout-color1) !important;
        }
    }
    
    .gpu-selection {
        margin-top: 15px;
        margin-left: 40px;
        padding: 18px;
        background: #ffffff;
        border: 1px solid #e5e9f0;
        border-radius: 12px;
        display: none;
        box-shadow: 0 3px 8px rgba(0,0,0,0.06);
    }
    
    .gpu-options-container {
        max-height: 180px; /* Height for approximately 3 options */
        overflow-y: auto;
        padding-right: 5px;
    }
    
    /* Scrollbar styling */
    .gpu-options-container::-webkit-scrollbar {
        width: 6px;
    }
    
    .gpu-options-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .gpu-options-container::-webkit-scrollbar-thumb {
        background: #c1c9d6;
        border-radius: 10px;
    }
    
    .gpu-options-container::-webkit-scrollbar-thumb:hover {
        background: #a1aebf;
    }
    
    .gpu-selection h6 {
        color: #2e3440;
        font-size: 1rem;
        margin-bottom: 16px;
        padding-bottom: 10px;
        border-bottom: 2px solid #ebecf0;
        font-weight: 600;
        position: relative;
    }
    
    .gpu-selection h6::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 60px;
        height: 2px;
        background: #5e81ac;
    }
    
    .gpu-option {
        margin: 10px 0;
        padding: 14px 16px;
        background: #f8f9fc;
        border: 1px solid #e5e9f0;
        border-radius: 10px;
        display: flex;
        align-items: center;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    
    .gpu-option:hover {
        background: #eceff4;
        border-color: #5e81ac;
    }
    
    .gpu-option:active {
        transform: translateY(0);
    }
    
    .gpu-option input[type="radio"] {
        margin-right: 12px;
        width: 18px;
        height: 18px;
        accent-color: #5e81ac;
    }
    
    .gpu-option-details {
        flex: 1;
    }
    
    .gpu-option-name {
        font-weight: 600;
        color: #2e3440;
        margin-bottom: 4px;
        font-size: 0.95rem;
    }
    
    .gpu-option-desc {
        font-size: 0.85rem;
        color: #4c566a;
        line-height: 1.4;
    }
    
    .gpu-option.selected {
        background: #e5e9f0;
        border-color: #5e81ac;
        box-shadow: 0 0 0 1px #5e81ac;
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: #4c566a;
    }

    .spinner {
        display: inline-block;
        width: 24px;
        height: 24px;
        border: 3px solid #e5e9f0;
        border-radius: 50%;
        border-top-color: #5e81ac;
        animation: spin 1s ease-in-out infinite;
        margin-right: 12px;
    }
    
    /* Collapsible section styles */
    .resource-category {
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .resource-category:hover {
        box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }
    
    .resource-category-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        background: #f8f9fa;
        cursor: pointer;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .resource-category-header:hover {
        background: linear-gradient(to right, #eef1f5, #e8ecf2);
    }
    
    .resource-category-header h5 {
        margin: 0;
        color: #2c3e50;
        font-size: 16px;
        font-weight: 600;
        display: flex;
        align-items: center;
    }
    
    /* Removed bullet point
    .resource-category-header h5::before {
        content: '';
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        margin-right: 10px;
        background-color: #5e81ac;
    }
    */
    
    .collapse-icon {
        font-size: 16px;
        transition: transform 0.2s ease;
        color: #5e81ac;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .collapsed .collapse-icon {
        transform: rotate(-90deg);
    }
    
    .collapsible-content {
        max-height: 1000px;
        overflow: hidden;
        transition: max-height 0.2s ease-out, padding 0.2s ease-out;
        background: #ffffff;
        padding: 20px;
    }
    
    .collapsed .collapsible-content {
        max-height: 0;
        padding: 0;
        border-top: none;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Scroll to bottom button styles */
    .scroll-to-bottom {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background-color: #5e81ac;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
        z-index: 1000;
    }
    
    .scroll-to-bottom:hover {
        background-color: #4c6c94;
    }
    
    .scroll-to-bottom.visible {
        opacity: 1;
        visibility: visible;
    }
</style>
</head>
<body>

<div id="loading" class="loading">
    <div class="spinner"></div>
    Loading available resources...
</div>

<div id="resourceForm" class="resource-container" style="max-width: 1000px; margin: 0 auto; padding: 25px; background: #f8f9fa; border-radius: 16px; display: none; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
    
    <div id="resourceList">
        <!-- Resources will be dynamically loaded here -->
    </div>
    
    <div id="noResources" style="padding: 20px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; color: #856404; display: none;">
        <strong>No resources available</strong><br>
        Please contact administrator for access.
    </div>
    
    <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid #e0e0e0; display: flex; align-items: center; flex-wrap: wrap;">
        <label for="runtime" style="color: #2c3e50; margin-right: 15px; font-weight: 500;">Run my server for (minutes):</label>
        <input name="runtime" 
               type="number" 
               min="10" 
               value="20" 
               max="240" 
               step="5" 
               style="width: 120px; padding: 10px 12px; border: 1px solid #d0d7de; border-radius: 8px; font-size: 14px; color: #2c3e50; box-shadow: inset 0 1px 2px rgba(0,0,0,0.05); transition: all 0.2s ease;" 
               onFocus="this.style.borderColor='#5e81ac'; this.style.boxShadow='0 0 0 3px rgba(94, 129, 172, 0.2)';"
               onBlur="this.style.borderColor='#d0d7de'; this.style.boxShadow='inset 0 1px 2px rgba(0,0,0,0.05)';"/>
    </div>
    
    <div style="margin-top: 25px;">
        <input type="submit" id="startButton" value="Launch" class="btn btn-jupyter form-control" style="padding: 10px 20px; font-weight: 500; transition: all 0.2s ease; border-radius: 8px; opacity: 0.5; cursor: not-allowed;" disabled>
    </div>
</div>

<!-- Scroll to bottom button -->
<div id="scrollToBottom" class="scroll-to-bottom">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
</div>

<script>
// GPU Node Options
const GPU_NODE_OPTIONS = {
    "phx": {
        "name": "phx", 
        "display_name": "AMD Radeonâ„¢ 780M (Phoenix Point iGPU)",
        "description": "RDNA 3.0 (gfx1103) | Compute Units 12 | 4GB LPDDR5X",
        "node_selector": {"node-type": "phx"},
        "env": { "HSA_OVERRIDE_GFX_VERSION": "11.0.0" }
    },
    "strix": {
        "name": "strix",
        "display_name": "AMD Radeonâ„¢ 890M (Strix Point iGPU)",
        "description": "RDNA 3.5 (gfx1150) | Compute Units 16 | 4GB LPDDR5X",
        "node_selector": {"node-type": "strix"},
        "env": {}
    },
    "strix-halo": {
        "name": "strix-halo",
        "display_name": "AMD Radeonâ„¢ 8060S (Strix Halo iGPU)",
        "description": "RDNA 3.5 (gfx1151) | Compute Units 40 | 64GB LPDDR5X",
        "node_selector": {"node-type": "strix-halo"},
        "env": {}
    },
    "dgpu": {
        "name": "dgpu",
        "display_name": "AMD Radeonâ„¢ 9070XT (Desktop GPU)", 
        "description": "RDNA 4.0 (gfx1201) | Compute Units 64 | 16GB GDDR6",
        "node_selector": {"node-type": "dgpu"},
        "env": {}
    }
};

const GFX1151_NODE_OPTIONS = {
    "strix-halo": {
        "name": "strix-halo",
        "display_name": "AMD Radeonâ„¢ 8060S (Strix Halo iGPU)",
        "description": "RDNA 3.5 (gfx1151) | Compute Units 40 | 64GB LPDDR5X",
        "node_selector": {"node-type": "strix-halo"},
        "env": {}
    }
};
const ROSCON2025_NODE_OPTIONS = {

        "strix-halo": {
            "name": "strix-halo",
            "display_name": "AMD Radeonâ„¢ 8060S (Strix Halo iGPU)",
            "description": "RDNA 3.5 (gfx1151) | Compute Units 40 | 64GB LPDDR5X",
            "node_selector": { "node-type": "strix-halo" },
            "env": {}
        }
    };

const NPU_NODE_OPTIONS = {
    "strix": {
        "name": "strix",
        "display_name": "AMD XDNA2 (Strix Point)",
        "description": "AMD XDNA2 NPU with AI acceleration", 
        "node_selector": {"type": "strix"}
    }
};

const RESOURCE_SPECS = {
        "cpu": {
            "name": "cpu",
            "group": "OTHERS", 
            "description": "Basic Python Environment",
            "sub_description": "CPU Only Environment",
            "cpu": "2",
            "memory": "4Gi",
            "accelerator": "CPU",
            "image": "ghcr.io/amdresearch/aup-cpu-notebook:v1.0"
        },
        // "mlir-aie": {
        //     "name": "mlir-aie",
        //     "group": "OTHERS", 
        //     "description": "IRON NPU Compiler (Alpha Test)",
        //     "sub_description": "Suitable for advanced AIE applications",
        //     "cpu": "4",
        //     "memory": "8Gi",
        //     "accelerator": "NPU",
        //     "image": "ghcr.io/amdresearch/aup-mliraie-notebook:v1.0",
        //     "gpu_options": NPU_NODE_OPTIONS
        // },
        "Course-CV": {
            "name": "Course-CV",
            "group": "COURSE", 
            "description": "Computer Vision Course",
            "sub_description": "Suitable for CV experiments with GPU",
            "cpu": "4",
            "memory": "16Gi",
            "accelerator": "GPU",
            "image": "ghcr.io/amdresearch/aup-course-cv:v1.3.1-TheRock",
            "gpu_options": GFX1151_NODE_OPTIONS
        },
        "Course-DL": {
            "name": "Course-DL",
            "group": "COURSE", 
            "description": "Deep Learning Course",
            "sub_description": "Suitable for DL experiments with GPU",
            "cpu": "4",
            "memory": "16Gi",
            "accelerator": "GPU",
            "image": "ghcr.io/amdresearch/aup-course-dl:v1.3.1-TheRock",
            "gpu_options": GFX1151_NODE_OPTIONS
        },
        "Course-LLM": {
            "name": "Course-LLM",
            "group": "COURSE", 
            "description": "Large Language Models Course",
            "sub_description": "Suitable for LLM experiments with GPU",
            "cpu": "4",
            "memory": "16Gi",
            "accelerator": "GPU",
            "image": "ghcr.io/amdresearch/aup-course-llm:v1.3.1-TheRock",
            "gpu_options": GFX1151_NODE_OPTIONS
        },
        "Tutorial-HIP-Intro": {
            "name": "Tutorial-HIP-Intro",
            "group": "TUTORIAL", 
            "description": "HIP Introduction Tutorial",
            "sub_description": "Suitable for learning HIP programming",
            "cpu": "4",
            "memory": "8Gi",
            "accelerator": "GPU",
            "image": "ghcr.io/amdresearch/aup-tutorial-hip-intro:v1.0.1",
            "gpu_options": GPU_NODE_OPTIONS
        },
        "Tutorial-LLM-Lemonade": {
            "name": "Tutorial-LLM-Lemonade",
            "group": "TUTORIAL", 
            "description": "LLM Lemonade Tutorial",
            "sub_description": "Suitable for LLM hands-on exercises",
            "cpu": "4",
            "memory": "8Gi",
            "accelerator": "GPU",
            "image": "ghcr.io/amdresearch/aup-tutorial-llm-lemonade:v1.3",
            "gpu_options": GFX1151_NODE_OPTIONS
        },
        "Tutorial-LLM-Ollama": {
        "name": "Tutorial-LLM-Ollama",
        "group": "TUTORIAL",
        "description": "LLM Ollama Tutorial",
        "sub_description": "Suitable for LLM hands-on exercises",
        "cpu": "4",
        "memory": "8Gi",
        "accelerator": "GPU",
        "image": "ghcr.io/amdresearch/aup-tutorial-llm-ollama:v1.0",
        "gpu_options": GFX1151_NODE_OPTIONS
    },
        "Tutorial-NPU-Resnet": {
            "name": "Tutorial-NPU-Resnet",
            "group": "TUTORIAL", 
            "description": "NPU ResNet Tutorial",
            "sub_description": "Suitable for ResNet inference on NPU",
            "cpu": "4",
            "memory": "8Gi",
            "accelerator": "NPU",
            "image": "ghcr.io/amdresearch/aup-tutorial-npu-resnet:v1.4-onnx-notebook",
            "gpu_options": NPU_NODE_OPTIONS
        },
        "none": {
            "name": "cpu",
            "group": "OTHERS",
            "description": "No team info",
            "sub_description": "Basic Environment | Limited Resources",
            "cpu": "2",
            "memory": "4Gi",
            "image": "ghcr.io/amdresearch/aup-cpu-notebook:v1.0"
        },
        "ROSCON2025-GPU": {
        "name": "ROSCON2025-GPU",
        "group": "ROSCON2025",
        "description": "GPU Workshop for RosCon2025",
        "sub_description": "Suitable for experiments with AMD GPU",
        "cpu": "4",
        "memory": "16Gi",
        "accelerator": "GPU",
        "image": "ghcr.io/amdresearch/aup-roscon2025-gpu:v1.0",
        "gpu_options": ROSCON2025_NODE_OPTIONS
        },
        "ROSCON2025-NPU": {
        "name": "ROSCON2025-NPU",
        "group": "ROSCON2025",
        "description": "NPU Workshop for RosCon2025",
        "sub_description": "Suitable for experiments with AMD XDNA NPU",
        "cpu": "4",
        "memory": "16Gi",
        "accelerator": "NPU",
        "image": "ghcr.io/amdresearch/aup-roscon2025-npu:v1.0",
        "gpu_options": ROSCON2025_NODE_OPTIONS
        },
        "ROSCON2025-DIGIT": {
        "name": "ROSCON2025-DIGIT",
        "group": "ROSCON2025",
        "description": "Digital_Twin_Handson Workshop for RosCon2025",
        "sub_description": "Suitable for experiments with AMD GPU",
        "cpu": "4",
        "memory": "16Gi",
        "accelerator": "GPU",
        "image": "ghcr.io/amdresearch/aup-roscon2025-digit:v1.0",
        "gpu_options": ROSCON2025_NODE_OPTIONS
        },
    };

// Fetch available resources from the backend
async function fetchAvailableResources() {
    // Check if resources are injected from the backend
    if (window.AVAILABLE_RESOURCES) {
        return window.AVAILABLE_RESOURCES;
    }
    
    // If not, try to read from hidden element
    const resourcesElement = document.getElementById('available-resources-data');
    if (resourcesElement) {
        try {
            return JSON.parse(resourcesElement.textContent);
        } catch (e) {
            console.error('Failed to parse available resources:', e);
        }
    }
    
    // Simulate API delay (for development)
    await new Promise(resolve => setTimeout(resolve, 500));
    
    // Return all resources by default (for development/testing)
    return ["cpu", "rocm", "torch", "ryzenai-onnx"];
}

function formatResourceDescription(cpu, memory, accelerator = null) {
    let resources = `${cpu} CPU, ${memory}GB Memory`;
    if (accelerator) {
        resources += `, 1 ${accelerator}`;
    }
    return resources;
}

function createResourceHTML(resource) {
    const resourceString = formatResourceDescription(resource.cpu, resource.memory, resource.accelerator);
    
    let gpuSelectionHTML = '';
    if (resource.gpu_options) {
        gpuSelectionHTML = `
            <div id="gpu_selection_${resource.name}" class="gpu-selection">
                <h6>Choose ${resource.accelerator} Node:</h6>
                <div class="gpu-options-container">
                    ${Object.entries(resource.gpu_options).map(([gpuKey, gpuOption], index) => `
                        <div class="gpu-option" onclick="selectGpuOption('${resource.name}', '${gpuKey}', event);">
                            <input type="radio" 
                                   id="gpu_${resource.name}_${gpuKey}" 
                                   name="gpu_selection_${resource.name}" 
                                   value="${gpuKey}"
                                   ${index === 0 ? 'checked' : ''}
                                   onclick="event.stopPropagation();">
                            <div class="gpu-option-details">
                                <div class="gpu-option-name">${gpuOption.display_name}</div>
                                <div class="gpu-option-desc">${gpuOption.description}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    return `
        <div class="resource-container" 
             style="margin-bottom: 14px; padding: 16px; border: 1px solid #e0e0e0; border-radius: 10px; display: flex; flex-direction: column; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.05); cursor: pointer;" 
             onmouseover="this.style.backgroundColor='#f9fafb';" 
             onmouseout="this.style.backgroundColor='white';" 
             onclick="selectResource('${resource.name}');">
            
            <div style="display: flex; align-items: center;">
                <input type="radio" 
                       id="${resource.name}" 
                       name="resource_type" 
                       value="${resource.name}" 
                       style="margin-right: 15px; width: 16px; height: 16px; accent-color: #6c7a89;"
                       onchange="toggleGpuSelection('${resource.name}');">
                
                <div style="flex: 1;">
                    <strong style="display: block; font-size: 15px; color: #2c3e50; margin-bottom: 4px;">${resource.description}</strong>
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                        <span class="env-desc" style="color: #34495e;">${resource.sub_description}</span>
                        <span class="dot" style="color: #95a5a6;">â€¢</span>
                        <span class="resource-tag" style="color: #c65d21; background: #fff5eb; padding: 2px 8px; border-radius: 3px; border: 1px solid #fbe5d6;">${resourceString}</span>
                    </div>
                </div>
            </div>
            
            ${gpuSelectionHTML}
        </div>
    `;
}

    async function loadResources() {
        try {
            const availableResourceNames = await fetchAvailableResources();
            const resourceListElement = document.getElementById('resourceList');

            if (availableResourceNames.length === 0) {
                document.getElementById('noResources').style.display = 'block';
            } else {
                // æŒ‰ COURSE / TUTORIAL / OTHERS åˆ†ç»„
                const groups = {
                    "ROSCON2025": [],
                    "COURSE": [],
                    "TUTORIAL": [],
                    "OTHERS": []
                };

                availableResourceNames.forEach(resourceName => {
                    const resource = RESOURCE_SPECS[resourceName];
                    if (resource) {
                        const group = resource.group || "OTHERS";
                        groups[group].push(resource);
                    }
                });

                let resourcesHTML = "";

                Object.keys(groups).forEach(groupName => {
                    const groupResources = groups[groupName];
                    if (groupResources.length === 0) return;

                    resourcesHTML += `
                    <div class="resource-category collapsed" id="${groupName}-category">
                        <div class="resource-category-header" onclick="toggleCategory('${groupName}-category')">
                            <h5 style="font-size: 18px;">ðŸ“‚ ${groupName}</h5>
                            <span class="collapse-icon">â–¼</span>
                        </div>
                        <div class="collapsible-content">
                            ${groupResources.map(resource => createResourceHTML(resource)).join('')}
                        </div>
                    </div>
                `;
                });

                resourceListElement.innerHTML = resourcesHTML;

            // Default select first resource
                if (availableResourceNames.length > 0) {
                    const firstResource = availableResourceNames[0];
                    document.getElementById(firstResource).checked = true;
                    toggleGpuSelection(firstResource);
                }
            }

            document.getElementById('resourceForm').style.display = 'block';
        } catch (error) {
            console.error('Error loading resources:', error);
            document.getElementById('noResources').style.display = 'block';
            document.getElementById('resourceForm').style.display = 'block';
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    }

function selectResource(resourceName) {
    // Select the radio button
    document.getElementById(resourceName).checked = true;
    
    // Toggle GPU selection visibility
    toggleGpuSelection(resourceName);
    
    // Enable the Start button
    enableStartButton();
}

function toggleGpuSelection(selectedResource) {
    // Hide all GPU selection panels
    const allGpuSelections = document.querySelectorAll('.gpu-selection');
    allGpuSelections.forEach(selection => {
        selection.style.display = 'none';
    });
    
    // Show GPU selection for the selected resource
    const selectedGpuSelection = document.getElementById('gpu_selection_' + selectedResource);
    if (selectedGpuSelection) {
        selectedGpuSelection.style.display = 'block';
        
        // Ensure first GPU option is selected by default
        const firstGpuOption = selectedGpuSelection.querySelector('input[type="radio"]');
        if (firstGpuOption && !selectedGpuSelection.querySelector('input[type="radio"]:checked')) {
            firstGpuOption.checked = true;
        }
    }
}

function selectGpuOption(resourceName, gpuKey, event) {
    event.stopPropagation();
    
    // Select the GPU radio button
    document.getElementById('gpu_' + resourceName + '_' + gpuKey).checked = true;
}

// Toggle category collapse/expand
function toggleCategory(categoryId) {
    const category = document.getElementById(categoryId);
    if (category) {
        const isCurrentlyCollapsed = category.classList.contains('collapsed');
        
        // First collapse all categories
        const allCategories = document.querySelectorAll('.resource-category');
        allCategories.forEach(cat => {
            cat.classList.add('collapsed');
            const catId = cat.id;
            localStorage.setItem(catId + '-collapsed', true);
        });
        
        // Then expand the clicked one if it was collapsed
        if (isCurrentlyCollapsed) {
            category.classList.remove('collapsed');
            localStorage.setItem(categoryId + '-collapsed', false);
        }
    }
}

// Set initial category states
function setInitialCategoryStates() {
    // Only need to ensure the CPU category is expanded
    const cpuCategory = document.getElementById('cpu-category');
    if (cpuCategory) {
        cpuCategory.classList.remove('collapsed');
        localStorage.setItem('cpu-category-collapsed', false);
    }
    
    // Set GPU and NPU to collapsed in localStorage
    localStorage.setItem('gpu-category-collapsed', true);
    localStorage.setItem('npu-category-collapsed', true);
}

// Clear selection when clicking elsewhere on the page
document.addEventListener('click', function(event) {
    // Check if the click is outside any gpu-option, resource-container, or scroll-to-bottom button
    if (!event.target.closest('.gpu-option') && 
        !event.target.closest('.resource-container') && 
        !event.target.closest('.scroll-to-bottom')) {
        
        // Clear all radio button selections
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.checked = false;
        });
        
        // Hide all GPU selection panels
        document.querySelectorAll('.gpu-selection').forEach(selection => {
            selection.style.display = 'none';
        });
        
        // Disable the Start button
        disableStartButton();
    }
});

// Function to enable the Start button
function enableStartButton() {
    const startButton = document.getElementById('startButton');
    if (startButton) {
        startButton.disabled = false;
        startButton.style.opacity = '1';
        startButton.style.cursor = 'pointer';
    }
}

// Function to disable the Start button
function disableStartButton() {
    const startButton = document.getElementById('startButton');
    if (startButton) {
        startButton.disabled = true;
        startButton.style.opacity = '0.5';
        startButton.style.cursor = 'not-allowed';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    loadResources();
    
    // Set initial category states immediately after resources are loaded
    document.getElementById('resourceForm').addEventListener('DOMNodeInserted', function handler() {
        if (document.getElementById('cpu-category')) {
            setInitialCategoryStates();
            // Remove this event listener after it's executed once
            document.getElementById('resourceForm').removeEventListener('DOMNodeInserted', handler);
        }
    });
    
    // Add event listeners to all radio buttons to enable the Start button
    document.addEventListener('change', function(event) {
        if (event.target.type === 'radio') {
            enableStartButton();
        }
    });
    
    // Scroll to bottom button functionality
    const scrollToBottomBtn = document.getElementById('scrollToBottom');
    
    // Show button when page is scrolled down
    window.addEventListener('scroll', function() {
        // Check if page height exceeds viewport height
        if (document.body.scrollHeight > window.innerHeight) {
            // Show button when scrolled down a bit
            if (window.scrollY > 100) {
                scrollToBottomBtn.classList.add('visible');
            } else {
                scrollToBottomBtn.classList.remove('visible');
            }
        }
    });
    
    // Scroll to bottom when button is clicked
    scrollToBottomBtn.addEventListener('click', function() {
        window.scrollTo({
            top: document.body.scrollHeight,
            behavior: 'smooth'
        });
    });
    
    // Initial check if scroll button should be visible
    if (document.body.scrollHeight > window.innerHeight) {
        if (window.scrollY > 100) {
            scrollToBottomBtn.classList.add('visible');
        }
    }
});
</script>
</body>
</html>
